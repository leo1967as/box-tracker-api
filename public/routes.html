<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>üß≠ ‡πÄ‡∏™‡πâ‡∏ô‡∏ó‡∏≤‡∏á‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</title>
  <link rel="stylesheet" href="style.css" />
  <!-- ‡πÉ‡∏™‡πà‡πÑ‡∏ß‡πâ‡πÉ‡∏ô <head> -->
<link rel="stylesheet" href="css/navbar.css" />

  <!-- <meta http-equiv="Content-Security-Policy" content="default-src 'self' https://*.googleapis.com https://*.gstatic.com; style-src 'self' 'unsafe-inline';"> -->

  <!-- Firebase -->
  <script src="https://www.gstatic.com/firebasejs/10.5.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.5.0/firebase-firestore-compat.js"></script>

  <style>
    .content-wrapper {
      padding: 2rem;
    }
    .route-card {
      border-bottom: 1px dashed #ccc;
      margin-bottom: 1rem;
      padding-bottom: 0.5rem;
    }
  </style>
</head>
<body>

  <!-- ‚úÖ Navbar ‡πÄ‡∏î‡∏¥‡∏° -->
  <nav class="navbar">
    <div class="logo">MyWebApp üöÄ</div>
    <ul class="nav-links">
      <li><a href="index.html">‡∏´‡∏ô‡πâ‡∏≤‡πÅ‡∏£‡∏Å</a></li>
      <li><a href="routes.html">‡πÄ‡∏™‡πâ‡∏ô‡∏ó‡∏≤‡∏á</a></li>
      <li><a href="delivery-history.html">‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏™‡πà‡∏á</a></li>
      <li><a href="organizations.html">‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏á‡∏≤‡∏ô</a></li>
      <li><a href="delivery.html">‡∏Å‡∏≤‡∏£‡∏Ç‡∏ô‡∏™‡πà‡∏á</a></li>
    </ul>
  </nav>

  <!-- ‚úÖ ‡πÄ‡∏ô‡∏∑‡πâ‡∏≠‡∏´‡∏≤‡∏´‡∏•‡∏±‡∏Å -->
  <div class="content-wrapper">
    <h1>üì¶ ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÄ‡∏™‡πâ‡∏ô‡∏ó‡∏≤‡∏á‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡∏à‡∏≤‡∏Å Firebase</h1>
    <div id="routesContainer">‚åõ ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î...</div>
  </div>

  <script>
    // üîß Firebase config
    const firebaseConfig = {
      apiKey: "AIzaSyDj4aYtdPAI3-uWGKUUcScYaTn66vhuTHt4",
      authDomain: "tissueboxdb.firebaseapp.com",
      projectId: "tissueboxdb",
      storageBucket: "tissueboxdb.appspot.com",
      messagingSenderId: "578294379663",
      appId: "1:578294379663:web:592d86722575dcc1676cfa",
      measurementId: "G-CE000PRNNC"
    };

    // ‚úÖ ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô Firebase
    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();

    // ‚úÖ ‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å Firestore
    async function loadRoutes() {
      const container = document.getElementById("routesContainer");
      try {
        const snapshot = await db.collection("routes").orderBy("savedAt", "desc").get();
        if (snapshot.empty) {
          container.innerHTML = "‚ùå ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏™‡πâ‡∏ô‡∏ó‡∏≤‡∏á‡πÉ‡∏ô Firebase";
          return;
        }

        container.innerHTML = "";
        snapshot.forEach(doc => {
            
          const data = doc.data();
          const savedAtDate = data.savedAt?.toDate?.(); // Firebase Timestamp -> Date
// const dateText = savedAtDate ? savedAtDate.toLocaleString() : "N/A";
        const dateText = savedAtDate
        ? savedAtDate.toLocaleString("th-TH", {
            year: "numeric",
            month: "long",
            day: "numeric",
            hour: "2-digit",
            minute: "2-digit"
            })
        : "N/A";
          const html = `
          
            <div class="route-card">
              üß≠ <b>${data.start}</b> ‚Üí <b>${data.end}</b><br/>
              ‚è±Ô∏è ‡∏£‡∏∞‡∏¢‡∏∞‡πÄ‡∏ß‡∏•‡∏≤: ${data.duration} ‡∏ô‡∏≤‡∏ó‡∏µ<br/>
              üóìÔ∏è ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÄ‡∏°‡∏∑‡πà‡∏≠: ${dateText}
            </div>
          `;
          container.innerHTML += html;
        });
      } catch (err) {
        container.innerHTML = "‚ùå ‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: " + err.message;
        console.error(err);
      }
    }

    loadRoutes();
  </script>
</body>
</html>
